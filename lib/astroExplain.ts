// lib/astroExplain.ts
// ✅ 保留导出命名：explainPlacementImpact / planetMeaning / zhBody / fmtDeg
// ✅ 不改你任何接口返回格式
// ✅ 目标：每颗行星骨架不同 + 12星座/12宫位全覆盖 + 行星×星座/行星×宫位交互句子池（稳定不重复）

type PlacementExplain = {
  title: string;
  oneLine: string;
  text: string;
  tags?: string[];
};

type BodyKey =
  | "Sun" | "Moon" | "Mercury" | "Venus" | "Mars"
  | "Jupiter" | "Saturn" | "Uranus" | "Neptune" | "Pluto"
  | "ASC" | "MC" | "NorthNode" | "SouthNode";

const BODY_ZH: Record<string, string> = {
  Sun: "太阳",
  Moon: "月亮",
  Mercury: "水星",
  Venus: "金星",
  Mars: "火星",
  Jupiter: "木星",
  Saturn: "土星",
  Uranus: "天王星",
  Neptune: "海王星",
  Pluto: "冥王星",
  ASC: "上升",
  MC: "天顶",
  NorthNode: "北交点",
  SouthNode: "南交点",
};

const SIGN_ZH: string[] = ["白羊","金牛","双子","巨蟹","狮子","处女","天秤","天蝎","射手","摩羯","水瓶","双鱼"];

// --------------------
// 0) 工具：稳定随机（同配置稳定）
// --------------------
function hash32(str: string) {
  let h = 2166136261;
  for (let i = 0; i < str.length; i++) {
    h ^= str.charCodeAt(i);
    h = Math.imul(h, 16777619);
  }
  return h >>> 0;
}

function pick(seedKey: string, arr: string[]) {
  if (!arr || !arr.length) return "";
  const h = hash32(seedKey);
  return arr[h % arr.length];
}

// --------------------
// 1) fmtDeg / zhBody / planetMeaning（你需要的命名）
// --------------------
export function fmtDeg(deg?: number) {
  if (deg === undefined || deg === null || Number.isNaN(Number(deg))) return "";
  const d = Math.floor(deg);
  const m = Math.floor((deg - d) * 60);
  return `${d}°${String(m).padStart(2, "0")}'`;
}

export function zhBody(body: string) {
  return BODY_ZH[body] || body;
}

export function planetMeaning(body: string) {
  const M: Record<string, string> = {
    Sun: "太阳代表你的核心自我、人生主轴、成就感来源，以及你想成为什么样的人。",
    Moon: "月亮代表你的情绪反应、安全感来源、内在需求与自我修复方式。",
    Mercury: "水星代表你的思维方式、沟通风格、学习路径与信息处理能力。",
    Venus: "金星代表你如何爱与被爱、你对关系的偏好、审美与价值取向（也关联金钱价值感）。",
    Mars: "火星代表你的行动方式、冲突反应、欲望与边界，以及你如何把能量变成结果。",
    Jupiter: "木星代表你的人生扩张方向、机会窗口、幸运来源与信念体系（你如何放大成功概率）。",
    Saturn: "土星代表你必须面对的课题、责任、限制与长期训练路径（你如何建立复利）。",
    Uranus: "天王星代表你人生中的突变点、创新与非典型选择（你如何更新系统）。",
    Neptune: "海王星代表你的理想、迷雾、共情力与逃避倾向（以及你如何让灵感落地）。",
    Pluto: "冥王星代表深度转化、极端体验与无法回避的重生主题（阴影与力量）。",
    ASC: "上升点代表你进入世界的方式、别人第一眼感受到的你，以及你的默认开场（盔甲）。",
    MC: "天顶代表你的事业主轴、社会角色、公众形象与想被世界记住的方式。",
    NorthNode: "北交点代表你这一生需要主动走向的成长方向（主线任务），越练越顺。",
    SouthNode: "南交点代表你已经熟悉的惯性模式（舒适区），省力但容易重复剧情。",
  };
  return M[body] || "这是你人格结构中的一个关键功能模块。";
}

// --------------------
// 2) 星座/宫位解释（全覆盖 12/12）
// --------------------
function signMeaning(sign: string): string {
  const M: Record<string, string> = {
    "白羊": "白羊是“启动与突破”的方式：更直接、更快、更敢先做再调整，靠行动获得确定感。",
    "金牛": "金牛是“稳定与沉淀”的方式：重视安全与可持续，慢但扎实，讲究积累与耐心。",
    "双子": "双子是“信息与连接”的方式：好奇、灵活、擅长沟通与快速学习，靠交流获得清晰。",
    "巨蟹": "巨蟹是“情绪与照料”的方式：重视归属与安全，敏感、护短，擅长保护与滋养自己在乎的人事物。",
    "狮子": "狮子是“表达与自我认可”的方式：需要被看见与被认可，擅长舞台感、领导与创造存在感。",
    "处女": "处女是“优化与系统”的方式：追求准确与可改进，擅长拆解、修正、流程化与持续升级。",
    "天秤": "天秤是“关系与平衡”的方式：重视合作、公平与审美，擅长协调、谈判与找到两全解。",
    "天蝎": "天蝎是“深度与掌控”的方式：洞察强、边界强，要么很真要么不要，在极端体验里完成转化。",
    "射手": "射手是“扩张与信念”的方式：追求自由、远方与意义，敢冲敢试，靠视野与信念驱动行动。",
    "摩羯": "摩羯是“责任与结果”的方式：看重长期结构与成就，能扛事、能打磨、能把事做成。",
    "水瓶": "水瓶是“创新与更新系统”的方式：非典型、理性、擅长重写规则与玩法，喜欢更高维的自由。",
    "双鱼": "双鱼是“共情与想象”的方式：直觉强、灵感足、感受力深，但边界易模糊，需要落地机制。",
  };
  return M[sign] || `「${sign}」决定你推进与表达的风格：你更习惯用什么方式做选择、处理压力、推进关系与目标。`;
}

function houseMeaning(house: number): string {
  const H: Record<number, string> = {
    1: "第1宫是“自我与开场”：外在气质、第一印象、人生起手式与自我形象。",
    2: "第2宫是“资源与价值”：金钱、价值感、安全感、你如何积累与交换、如何定价自己。",
    3: "第3宫是“学习与表达”：沟通、写作、信息处理、日常互动、短途出行与学习节奏。",
    4: "第4宫是“家庭与根基”：归属感、内在安全、家庭模式、私域与基地（你从哪里充电）。",
    5: "第5宫是“创造与热爱”：恋爱、创作、表达欲、孩子、作品与玩乐（你如何发光）。",
    6: "第6宫是“日常与系统”：工作流、习惯、效率、健康与可重复执行（你如何稳定产出）。",
    7: "第7宫是“关系与合作”：伴侣、重要合伙、契约、投射与边界（你如何面对对等关系）。",
    8: "第8宫是“深度与重生”：亲密、信任、共享资源、控制/失控、危机与蜕变（你如何变强）。",
    9: "第9宫是“远方与信念”：高等学习、哲学、跨文化、远行、意义系统与世界观。",
    10:"第10宫是“事业与名声”：社会角色、成就路径、公众形象与权威（你如何被世界记住）。",
    11:"第11宫是“社群与未来”：人脉、社群、平台、资源放大、愿景与长期合作。",
    12:"第12宫是“潜意识与恢复”：隐秘、梦、疗愈、内耗与放下（你如何退回深处修复）。",
  };
  return H[house] || `第${house}宫代表一个反复出现的人生主题领域。`;
}

// --------------------
// 3) 句子池：星座风格提示（12星座全覆盖）
// --------------------
function signStyleHints(sign: string): string[] {
  const pool: Record<string, string[]> = {
    "白羊": [
      "你倾向于先做再校准，行动带来确定感。",
      "你不太喜欢绕弯子，越直接越舒服。",
      "你在压力下可能更冲动，需要一个刹车机制。",
      "你一旦决定了，就会很快推进到结果。"
    ],
    "金牛": [
      "你更看重稳定与可持续，慢一点但会更稳。",
      "你在确认安全感之前，不会轻易全压。",
      "你喜欢可见的积累：资产、技能、作品、关系。",
      "压力下可能更固执，改变需要循序渐进。"
    ],
    "双子": [
      "你靠信息流驱动自己：越交流越清晰。",
      "你更适合边学边做、快速迭代。",
      "你在信息过载时容易分心，需要优先级。",
      "你擅长把复杂讲清楚，也擅长连接资源。"
    ],
    "巨蟹": [
      "你更靠“感觉对不对”判断，再决定要不要投入。",
      "有归属感时，你会更稳定、更长线。",
      "你擅长照顾与保护，但也容易过度消耗。",
      "压力下可能更敏感，需要安全的修复空间。"
    ],
    "狮子": [
      "你需要被看见与被认可，舞台感会点燃你。",
      "你更适合把能力做成作品/名声/影响力。",
      "你在压力下可能更在意面子，需要把自尊和事实分开。",
      "你愿意承担责任，但前提是它值得。"
    ],
    "处女": [
      "你擅长拆解与优化：把问题变成流程。",
      "你更信任细节与证据，靠正确性获得安全感。",
      "压力下可能更挑剔或焦虑，需要“够好就交付”。",
      "你适合建立系统：清单、模板、复盘机制。"
    ],
    "天秤": [
      "你重视公平与合作，擅长协调与谈判。",
      "你会从关系质量判断选择是否正确。",
      "压力下可能犹豫不决，需要明确权重与底线。",
      "你喜欢审美与秩序，环境会影响状态。"
    ],
    "天蝎": [
      "你看重深度与真相，不喜欢浅层应付。",
      "你对边界与信任非常敏感，洞察力很强。",
      "压力下可能更控制或更极端，需要把控制换成规则。",
      "你适合做“深水区”的事：研究、危机处理、转化。"
    ],
    "射手": [
      "你需要自由与意义感，否则很难持续。",
      "你愿意先冲出去，再边走边校准。",
      "压力下可能高估风险承受，需要写清底线。",
      "你适合扩张视野：学习、远行、跨界、传播。"
    ],
    "摩羯": [
      "你愿意为长期结果付出短期代价。",
      "你擅长扛责任、做结构、做复利。",
      "压力下可能把自己当机器，需要安排恢复机制。",
      "你越有清晰目标，越能稳定推进。"
    ],
    "水瓶": [
      "你喜欢更新系统，不喜欢被固定死。",
      "你擅长用新规则、新玩法获得优势。",
      "压力下可能抽离或突然断联，需要保持沟通接口。",
      "你适合做创新与平台型事情：社群、产品、协议、网络。"
    ],
    "双鱼": [
      "你直觉强、感受深，灵感是你的燃料。",
      "你需要边界与现实校准，否则容易飘。",
      "压力下可能逃避或麻木，需要小步落地。",
      "你适合把想象做成作品：内容、艺术、疗愈与共情表达。"
    ],
  };
  return pool[sign] || [
    `「${sign}」会影响你的推进节奏、表达方式与压力反应。`,
    `当你用对「${sign}」优势时更顺；用过量就会变成盲点。`,
  ];
}

// --------------------
// 4) 句子池：宫位触发提示（12宫全覆盖）
// --------------------
function houseTriggers(house: number): string[] {
  const pool: Record<number, string[]> = {
    1: [
      "当你要定义“我是谁”、要不要站出来时，这块会被触发。",
      "陌生场景里，你会更在意形象与气场是否在线。",
      "你会被推着练习：更自信、更果断、更像你自己。",
      "你的人生会反复出现“开局方式”的升级。"
    ],
    2: [
      "当“钱/价值/条件”摆上桌面，你会特别敏感。",
      "你会反复遇到：值不值、配不配、该不该。",
      "资源与安全感议题会长期出现，逼你建立系统。",
      "你要学会给自己定价，而不是等别人评价。"
    ],
    3: [
      "一旦需要表达、解释、说服，你的状态会被点亮。",
      "信息密集的场景会让你更活跃，也更容易过载。",
      "你会被推着练：把复杂讲清楚、把信息变成影响力。",
      "学习与沟通会成为你的长期升级能力。"
    ],
    4: [
      "当你想躲起来、想回家、想恢复时，这块会被触发。",
      "你需要一个可恢复的基地，否则容易耗损。",
      "家庭与归属议题会影响你很多关键选择。",
      "你会被推着建立：内在安全与稳定的根基。"
    ],
    5: [
      "当你想表达、想恋爱、想创造、想被喜欢时，这块会被触发。",
      "你会在作品、热爱与舞台感中恢复能量。",
      "你会被推着练：如何发光、如何持续输出热情。",
      "被认可与被喜爱是你重要的动力来源。"
    ],
    6: [
      "当你要把生活跑顺、把工作做成系统时，这块会被触发。",
      "你会被推着建立：习惯、节奏、健康与稳定产出。",
      "压力大时，身体与效率会直接反映你的状态。",
      "你需要可重复执行的流程，而不是靠意志硬扛。"
    ],
    7: [
      "当你进入亲密/合作/谈条件时，这块会被触发。",
      "你会被推着学习：边界、契约、对等与合作结构。",
      "你很容易在关系里看到自己的投射与盲点。",
      "你要练的是：既能靠近，也能保持自我。"
    ],
    8: [
      "当出现信任、金钱纠葛、亲密绑定时，你会被强烈触发。",
      "这是一条重生路线：危机不是惩罚，是升级入口。",
      "越深的关系越需要规则与边界，否则容易失控。",
      "控制/失控的议题会反复出现，逼你变强。"
    ],
    9: [
      "当你追问意义、信念、远方与未来方向时，这块会被触发。",
      "你会被推着建立世界观：我相信什么？我要去哪里？",
      "学习体系与视野扩张会改变你的人生层级。",
      "你需要一套“解释人生”的框架，才能走得更远。"
    ],
    10: [
      "当你被看见、被评价、被要求负责时，这块会被触发。",
      "事业与名声会成为你需要长期经营的资产。",
      "你会在位置与责任中成长，形成权威感。",
      "你要练的是：把能力做成可见的成果与信用。"
    ],
    11: [
      "当社群、人脉、平台机会出现时，你更容易迎来突变。",
      "你需要用网络与平台放大自己，而不是单打独斗。",
      "关系质量决定资源质量：你会被推着升级社交结构。",
      "你的未来愿景需要靠合作与社群承载。"
    ],
    12: [
      "当你想逃离、想消失、想睡一觉时，这块会被触发。",
      "潜意识与内耗会影响你的决策：越压越反扑。",
      "你要练的是：疗愈、放下、恢复、与自己和解。",
      "你需要定期退回深处修复，否则灵感与能量会枯竭。"
    ],
  };
  return pool[house] || [
    `第${house}宫相关的场景会反复出现，并推动你升级。`,
    `当它出现“重复剧情”，说明这不是偶然，而是长期课题。`,
  ];
}

// --------------------
// 5) 交互句子池：行星×星座、行星×宫位（MVP但有效）
//    ✅ 不是写满 12x12x15（太巨大），而是：
//    - 每颗行星有自己的专属池（先保证“行星不同”）
//    - 再叠加星座/宫位池（保证“组合不同”）
// --------------------
function planetSignHints(body: BodyKey, sign: string): string[] {
  const base = signStyleHints(sign);

  const P: Partial<Record<BodyKey, Record<string, string[]>>> = {
    Sun: {
      "巨蟹": [
        "你的主轴更偏向“归属与内在安全”：你要把人生建立在一个能让你安心的基地上。",
        "你会在照顾与被照顾之间找到自我认同：真正的强大来自稳定的根。",
      ],
      "双子": [
        "你的主轴靠“理解与表达”点燃：你越能讲清楚，越能成为你自己。",
        "你会通过学习与交流确认自我：对你来说，成长就是不断更新认知。",
      ],
    },
    Moon: {
      "天蝎": [
        "你的情绪更深、更强烈：一旦不安全，你会本能进入防御或控制。",
        "你需要“真诚 + 边界”，否则容易在情绪里极端化。",
      ],
      "双鱼": [
        "你的情绪共情力很强：别人一难受你就跟着难受，需要学会分离。",
        "你需要把情绪落地成照顾动作：睡眠/饮食/节奏就是你的药。",
      ],
    },
    Mercury: {
      "处女": [
        "你的思维偏结构化：擅长把混乱变成系统与流程。",
        "你需要允许“60分输出”，否则容易卡在完美主义。",
      ],
      "射手": [
        "你的思维更看大局：先抓意义再补细节。",
        "你需要一个事实校准机制，否则容易过度乐观。",
      ],
    },
    Venus: {
      "金牛": [
        "你在爱里看重稳定与触感：陪伴、时间、生活细节比口头更重要。",
        "你容易因为安全感而坚持，但也要防止惯性消耗。",
      ],
      "双子": [
        "你在爱里需要对话与新鲜感：没有交流会快速降温。",
        "你更容易被“脑子好使、会聊、能一起成长”的人吸引。",
      ],
    },
    Mars: {
      "白羊": [
        "你的行动很快：想到了就做，冲劲就是你的优势。",
        "你需要学会刹车：先确认边界，再释放力量。",
      ],
      "摩羯": [
        "你的行动偏稳狠：更能扛、更能长期推进。",
        "你的挑战是：别把情绪压成硬扛，记得安排恢复。",
      ],
    },
    Saturn: {
      "摩羯": [
        "土星在摩羯是强配置：你天生适合做长期结构与结果。",
        "你的课题是：别把自己逼成机器，留出人性与弹性。",
      ],
      "双子": [
        "你的课题会落在“信息/表达/价值”的纪律上：怎么说、说什么、值不值。",
        "你要练的是稳定输出，而不是灵感冲刺。",
      ],
    },
  };

  const extra = P[body]?.[sign] || [];
  return [...extra, ...base];
}

function planetHouseHints(body: BodyKey, house: number): string[] {
  const base = houseTriggers(house);

  const P: Partial<Record<BodyKey, Record<number, string[]>>> = {
    Sun: {
      10: ["你的主轴会被推到公众场域：你需要做出可见成果，建立名声与权威。"],
      4: ["你的主轴更偏内在：先把根基建稳，你才会越来越强。"],
      7: ["你的主轴会被关系点亮：你通过重要合作/亲密关系认识自己。"],
    },
    Moon: {
      6: ["你的情绪与身体/节奏绑定：作息一乱，情绪就会波动。"],
      12: ["你更需要独处与退隐恢复：你不是弱，是需要充电。"],
      2: ["你的安全感跟资源强相关：钱/价值感会直接影响情绪稳定。"],
    },
    Mercury: {
      3: ["这是水星最舒服的位置：沟通、学习、表达是你的核心武器。"],
      9: ["你的思维更偏体系化：适合做框架、方法论与跨文化表达。"],
      10:["你的表达会直接变成事业：你说什么、怎么说，会塑造你的公众形象。"],
    },
    Venus: {
      2: ["你会把爱与价值绑定：关系里非常在意值不值、配不配、公不公平。"],
      5: ["你更容易在恋爱与创造中发光：美感与浪漫是你的补能量方式。"],
      7: ["你在关系里学习爱：合作与亲密是你重要的人生课题。"],
    },
    Mars: {
      8: ["你的火力集中在深水区：信任、占有、危机、重生议题会强烈触发。"],
      1: ["你的行动直接写在脸上：你更适合先冲锋，再优化策略。"],
      6: ["你的战斗发生在日常：你需要用纪律与训练把能量变成稳定产出。"],
    },
    Jupiter: {
      9: ["你的好运来自视野扩张：学习/远行/跨界会把你带到更大层级。"],
      11:["你的好运来自社群与平台：贵人、人脉、机会在网络里放大。"],
      3: ["你的好运来自表达：你越能讲清楚，越能吸引机会。"],
    },
    Saturn: {
      2: ["你的课题在价值与资源：你会被逼着建立定价、复利与长期安全感。"],
      10:["你的课题在事业与名声：要扛责任、要做成果、要长期经营信用。"],
      6: ["你的课题在习惯与系统：稳定执行就是你的成功公式。"],
    },
    Uranus: {
      11:["突变常发生在社群/平台：你的人生会被网络机会突然改写。"],
      10:["事业路径容易非典型：你更适合创新角色，而不是标准岗位。"],
    },
    Neptune: {
      10:["你容易理想化事业与名声：需要现实校准机制，避免飘。"],
      12:["你灵感很强但也易内耗：需要恢复与边界来保护自己。"],
    },
    Pluto: {
      8: ["这是冥王最强的位置：深度转化是你的主修课，穿过真相你会变得很强。"],
      10:["事业里会经历强烈的升级/重启：你会被迫更真实、更强大。"],
    },
    ASC: {
      1: ["上升本就关联第1宫：你的开场方式会被放大，别人很容易第一眼就感受到。"],
    },
    MC: {
      10:["天顶本就关联第10宫：职业/名声主题会更明显，你需要一个可见的长期路径。"],
    },
    NorthNode: {
      3: ["主线任务在表达：越写、越讲、越沟通，你的人生越顺。"],
      10:["主线任务在承担社会角色：你会被推到更大的责任与位置上。"],
    },
    SouthNode: {
      9: ["舒适区在世界观/宏大叙事：你可能很会讲道理，但要注意落地与行动。"],
      12:["舒适区在退隐与逃离：你会想躲，但成长在“走出来”。"],
    },
  };

  const extra = P[body]?.[house] || [];
  return [...extra, ...base];
}

// --------------------
// 6) 行星骨架（全部不同）
// --------------------
function byBodyBlueprint(body: BodyKey) {
  const map: Record<BodyKey, {
    opener: string[];
    focusTitle: string;
    patterns: string[];
    pitfalls: string[];
    actions: string[];
  }> = {
    Sun: {
      opener: [
        "你的核心驱动不是“做更多”，而是“做对你来说有意义的那件事”。",
        "你真正会被点燃的，是“我是谁，我要把人生用在哪里”。",
        "主轴一对齐，你的执行力会像开闸一样出来。"
      ],
      focusTitle: "人生主轴与自我认同",
      patterns: [
        "你会把某个领域当作“必须认真对待的主线”，否则容易空心。",
        "关键选择时，你会反复问：这是不是我真正想成为的样子？",
      ],
      pitfalls: [
        "为了安全感而偏离主轴：短期舒服，长期空。",
        "把“别人期待的我”当成“我是谁”。",
      ],
      actions: [
        "写下你最在意的 3 个关键词（自由/成就/归属…），每次选择都拿它们对齐。",
        "把主轴做成可执行版本：本周只做 1 个能推进它的动作。",
      ],
    },

    Moon: {
      opener: [
        "你的情绪不是问题，它是导航系统：告诉你哪里安全、哪里不安全。",
        "情绪对你来说不是噪音，而是系统告警。",
        "你越懂自己的安全感来源，越不会被情绪牵着做决定。"
      ],
      focusTitle: "情绪系统与安全感来源",
      patterns: [
        "你对环境与人的变化更敏感，容易先感受到氛围。",
        "你会本能寻找恢复方式（人/空间/节奏）。",
      ],
      pitfalls: [
        "情绪堆到爆才处理，决策质量会直线下降。",
        "用控制/回避/硬扛替代真正的感受与修复。",
      ],
      actions: [
        "做一个情绪出口固定动作：每天 10 分钟（写一句/走一圈/洗热水/听一首）。",
        "现场急救：停 30 秒 → 命名情绪 → 再决定要不要回应。",
      ],
    },

    Mercury: {
      opener: [
        "你更像系统解释器：把复杂翻译成可执行。",
        "你的表达清晰度，直接决定你能换到多少资源。",
        "你越会结构化表达，越容易被理解、被支持、被信任。"
      ],
      focusTitle: "思维方式与表达系统",
      patterns: [
        "你会下意识拆解问题→找规律→给方案。",
        "你更依赖信息流与沟通来推进事情。",
      ],
      pitfalls: [
        "信息过载时碎片化输出：说很多但不落地。",
        "被误解时容易情绪化反击，沟通变对抗。",
      ],
      actions: [
        "沟通模板：先结论 → 两条理由 → 一个明确需求。",
        "建立输出优先：先写 60 分版本，再迭代到 90 分。",
      ],
    },

    Venus: {
      opener: [
        "你在关系与价值上追求的不是浪漫，而是匹配。",
        "你会用“值不值、合不合”来判断人和选择。",
        "你越清楚自己的价值系统，越不容易在关系里丢自己。"
      ],
      focusTitle: "关系模式与价值系统",
      patterns: [
        "你会被相处舒服 + 价值交换公平吸引。",
        "你对气质、表达方式、审美与细节很敏感。",
      ],
      pitfalls: [
        "为了被喜欢而过度迁就，价值感流失。",
        "把短期情绪当长期匹配依据。",
      ],
      actions: [
        "把“我需要什么 / 我愿意给什么”写成清单，别靠猜。",
        "看行动：对方做到了什么，而不是说了什么。",
      ],
    },

    Mars: {
      opener: [
        "你的行动力来自想赢、想突破、想把事做成。",
        "你一旦被点燃，会很直接推进结果。",
        "火星不是脾气，是你把能量变成结果的方式。"
      ],
      focusTitle: "行动方式与冲突反应",
      patterns: [
        "你在关键时刻更敢拍板，倾向先动起来。",
        "你会在边界/竞争/欲望议题上更敏感。",
      ],
      pitfalls: [
        "把推进当压迫：关系里容易越界或误伤。",
        "行动太快忽略风险与代价。",
      ],
      actions: [
        "冲突三句法：我感受__ → 我需要__ → 我建议__。",
        "行动前写下最坏情况 + 应对方案，给自己安全阀。",
      ],
    },

    Jupiter: {
      opener: [
        "你的幸运来自扩张认知与视野：越升级越容易踩中机会。",
        "木星给你的不是运气，是扩大成功概率的方法。",
        "你越愿意走出去/讲清楚/放大影响，越容易遇到窗口。"
      ],
      focusTitle: "扩张方向与好运机制",
      patterns: [
        "你更容易因为学习、传播、连接而获得机会。",
        "你偏向先看大格局，再决定投入。",
      ],
      pitfalls: [
        "摊子铺太大，承诺超载导致失焦。",
        "只追风口不做复利，机会来了也接不住。",
      ],
      actions: [
        "每季度复盘：你真正可复制的增长点是什么？",
        "把好运沉淀成库：关系/资源/方法论都要归档。",
      ],
    },

    Saturn: {
      opener: [
        "土星不会让你轻松，但会让你强：它要你把基础打厚。",
        "你会被逼着建立规则、边界与长期结构。",
        "土星的礼物是不可替代，前提是你愿意长期练。"
      ],
      focusTitle: "长期课题与复利训练",
      patterns: [
        "你对责任、成果、长期稳定更敏感。",
        "你会在关键领域被要求更专业、更可持续。",
      ],
      pitfalls: [
        "用自我苛责推动自己，长期耗损。",
        "把慢当失败：其实你是慢热但越做越强。",
      ],
      actions: [
        "设 6–12 个月里程碑，用长期尺子衡量自己。",
        "把压力拆成任务：今天只完成最关键 1 步。",
      ],
    },

    Uranus: {
      opener: [
        "你的人生会出现突然转向：但那不是崩坏，是更新版本。",
        "你不适合一直走标准路，你适合更新系统。",
        "你的突破往往来自非典型选择。"
      ],
      focusTitle: "突变点与创新路径",
      patterns: [
        "你容易被新玩法、新结构、新关系网吸引。",
        "你适合做试验与迭代，不适合被过度固定。",
      ],
      pitfalls: [
        "更新太快：旧系统没收尾，新系统也没跑稳。",
        "关系多而浅：信息多但资源沉不下来。",
      ],
      actions: [
        "先小范围试验，再全量切换（把变化做成可控实验）。",
        "每月只维护 Top 5 高质量关系：深比广更值钱。",
      ],
    },

    Neptune: {
      opener: [
        "你在这里最容易被灵感眷顾，也最容易被迷雾拖住。",
        "海王星的关键不是做梦，而是把梦落地。",
        "你的共情力很强，但需要边界保护自己。"
      ],
      focusTitle: "理想、迷雾与边界",
      patterns: [
        "你容易理想化人或目标，也容易被氛围影响判断。",
        "你对意义感与想象空间很敏感。",
      ],
      pitfalls: [
        "用幻想替代行动：很想，但不推进。",
        "边界模糊：为了感受牺牲结构与节奏。",
      ],
      actions: [
        "每周做一次现实校准复盘：我做了什么？结果是什么？下一步是什么？",
        "把愿景拆成 3 个可验证指标（能测量就不会飘）。",
      ],
    },

    Pluto: {
      opener: [
        "你在这里无法敷衍：真相会逼你蜕皮。",
        "冥王星的礼物是力量，但要先穿过真相。",
        "你越敢面对阴影，越能拿回掌控感。"
      ],
      focusTitle: "深度转化与阴影议题",
      patterns: [
        "你对控制/信任/背叛/深度绑定议题更敏感。",
        "你会经历极端体验，然后被迫升级版本。",
      ],
      pitfalls: [
        "非黑即白：要么全给，要么全撤。",
        "把深度误当控制：越抓越失控。",
      ],
      actions: [
        "把控制换成协商：明确规则、明确底线、明确交换。",
        "训练三句：我怕什么？我需要什么？我用什么边界交换安全感？",
      ],
    },

    ASC: {
      opener: [
        "上升不是你全部的你，但它是你进入世界的默认开场。",
        "别人第一眼感受到的，是你这套起手式。",
        "上升像盔甲：好用，但别被盔甲绑架。"
      ],
      focusTitle: "第一印象与人生起手式",
      patterns: [
        "陌生场景里，你会更像上升而不是太阳。",
        "你习惯先用一种方式进入局面，再慢慢暴露真实需求。",
      ],
      pitfalls: [
        "过度依赖盔甲：把防御当个性。",
        "为了保持形象，压住真实需求导致内耗。",
      ],
      actions: [
        "准备一句边界句：到这一步我需要时间/我先确认信息/我稍后回复。",
        "重要关系里练慢一点：让真实需求也有位置。",
      ],
    },

    MC: {
      opener: [
        "MC 不是你做什么工作，而是你用什么方式成为可被信任的人。",
        "你的职业路径需要一个可见的方向与结构。",
        "你越清楚想被世界如何记住，越不容易走偏。"
      ],
      focusTitle: "事业方向与公众形象",
      patterns: [
        "你会在社会角色里追求成就、影响力或权威感。",
        "你更在意长期可积累的名声资产。",
      ],
      pitfalls: [
        "形象焦虑：为了看起来正确而牺牲节奏。",
        "只做短期成绩，名声不沉淀。",
      ],
      actions: [
        "先做高质量交付，再谈更大的舞台（名声来自交付）。",
        "给事业设 3 年路径：领域→作品→平台（每年一个可见成果）。",
      ],
    },

    NorthNode: {
      opener: [
        "北交点是你的主线任务：不一定舒服，但练了就会更顺。",
        "北交不是天赋，是你要练出来的方向。",
        "你会被反复推到同类场景里：那是升级入口。"
      ],
      focusTitle: "成长方向（主线任务）",
      patterns: [
        "你越走向它，人生越顺；越逃避，剧情越重复。",
        "它要求你用更成熟的方式回应同类问题。",
      ],
      pitfalls: [
        "用旧技能硬扛新关卡：表面能过，长期卡住。",
        "把不熟练当不适合：其实是升级期。",
      ],
      actions: [
        "把主线拆成每周一个小训练（可衡量、可重复）。",
        "每次重复剧情出现，问：这关要我练的是什么？",
      ],
    },

    SouthNode: {
      opener: [
        "南交点是你的舒适区技能：会用，但别被它用。",
        "它像自动驾驶：省力，但容易让你重复剧情。",
        "南交能保命，但不负责让你升级。"
      ],
      focusTitle: "惯性模式（舒适区）",
      patterns: [
        "压力一来，你会自动启动这套熟练反应。",
        "它通常有效，但会让你在同一层级打转。",
      ],
      pitfalls: [
        "把舒适区当身份：越熟练越难跳出。",
        "用惯性替代成长：一直在做会的事。",
      ],
      actions: [
        "把它当技能而不是人格：关键时刻先停 3 秒再选。",
        "建立替代动作：同样压力，用一个新选择回应一次。",
      ],
    },
  };

  return map[body];
}

// --------------------
// 7) explainPlacementImpact：你要的“人话结构”
//    ✅ 行星代表什么 → 星座代表什么 → 宫位代表什么 → 合并解释 → 表现/坑/建议
// --------------------
export function explainPlacementImpact(args: {
  body: string;
  sign: string;
  house: number;
  degree?: number;
}): PlacementExplain {
  const body = args.body as BodyKey;
  const bodyZh = zhBody(args.body);
  const sign = args.sign;
  const house = Number(args.house);

  const seedKey = `${args.body}|${sign}|${house}`;

  const pMeaning = planetMeaning(args.body);
  const sMeaning = signMeaning(sign);
  const hMeaning = houseMeaning(house);

  const bp = byBodyBlueprint(body);

  const opener = pick(seedKey + "|opener", bp.opener);

  // 交互池（行星×星座、行星×宫位）
  const ps = pick(seedKey + "|ps", planetSignHints(body, sign));
  const ph = pick(seedKey + "|ph", planetHouseHints(body, house));

  const title = `${bodyZh}｜${sign}｜第${house}宫`;
  const oneLine = `你的${bodyZh}会用「${sign}」的方式，在「第${house}宫」这个领域反复发力与被触发。`;

  const combo = [
    `【把三件事叠在一起看】`,
    `- ${bodyZh}（行星）= 你人格里的哪块功能：${bp.focusTitle}`,
    `- ${sign}（星座）= 你推进它的风格：${ps}`,
    `- 第${house}宫（宫位）= 它主要发生的领域：${ph}`,
    ``,
    `因此：**${bodyZh}在${sign}第${house}宫**，意味着你会在「${hMeaning}」相关的场景里，用${sign}的方式处理${bp.focusTitle}议题。`,
  ].join("\n");

  const patterns = [
    `【你更可能出现的表现】`,
    ...bp.patterns.map((x, idx) => `${idx + 1}) ${x}`),
    `补充（星座风格）：${ps}`,
    `补充（宫位触发）：${ph}`,
  ].join("\n");

  const pitfalls = [
    `【你更容易踩的坑】`,
    ...bp.pitfalls.map((x, idx) => `${idx + 1}) ${x}`),
  ].join("\n");

  const actions = [
    `【可执行建议】`,
    ...bp.actions.map((x, idx) => `${idx + 1}) ${x}`),
    `额外训练：用「触发 → 选择 → 结果」记录 3 次重复剧情，你会看到自己的默认脚本。`,
  ].join("\n");

  const text = [
    `📍 ${title}`,
    ``,
    `🧾 ${bodyZh}代表什么？`,
    `${pMeaning}`,
    ``,
    `♈ 星座「${sign}」代表什么？`,
    `${sMeaning}`,
    ``,
    `🏠 第${house}宫代表什么？`,
    `${hMeaning}`,
    ``,
    `🧠 结合在一起代表什么？`,
    `${opener}`,
    combo,
    ``,
    patterns,
    ``,
    pitfalls,
    ``,
    actions,
  ].join("\n");

  return {
    title,
    oneLine,
    text,
    tags: [bodyZh, sign, `第${house}宫`],
  };
}
