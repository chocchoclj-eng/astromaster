// lib/buildAstroPrompt.ts
export function buildAstroPrompt(args: {
  mode: "A" | "B" | "C";
  userName?: string;
  overview?: string;
  humanSummary: Array<{
    title: string;
    oneLine: string;
    bullets: string[];
    advice?: string[];
  }>;
}) {
  const { mode, userName, overview, humanSummary } = args;

  const modeTitle = {
    A: "æƒ…æ„Ÿä¸å…³ç³»ï¼ˆäº²å¯†å…³ç³»ã€ä¾æ‹æ¨¡å¼ã€æ²Ÿé€šä¸è¾¹ç•Œï¼‰",
    B: "äº‹ä¸šä¸è´¢å¯Œï¼ˆä¼˜åŠ¿èµ›é“ã€å·¥ä½œæ–¹å¼ã€å˜ç°è·¯å¾„ã€é£é™©ç‚¹ï¼‰",
    C: "çµé­‚ä¸åˆ›ä¼¤&åˆ›é€ åŠ›ï¼ˆæ½œæ„è¯†ã€å¡ç‚¹æ¥æºã€ç–—æ„ˆè·¯å¾„ã€å¤©èµ‹ï¼‰",
  }[mode];

  return `
ä½ æ˜¯ä¸€ä½ç°ä»£å æ˜Ÿå¸ˆ + å¿ƒç†å­¦å–å‘å’¨è¯¢å¸ˆï¼Œè¡¨è¾¾æ¸…æ™°ã€å…·ä½“ã€ä¸è¿·ä¿¡ï¼Œä¸ç”¨ç„å­¦å£å»ã€‚

ç”¨æˆ·ï¼š${userName || "åŒ¿åç”¨æˆ·"}
å¿«é€Ÿæ€»è§ˆï¼š${overview || "ï¼ˆæ— ï¼‰"}

ä¸‹é¢æ˜¯å·²ç»ç¡®è®¤çš„â€œæ˜Ÿç›˜ç»“è®ºâ€ï¼ˆç¡®å®šäº‹å®ï¼Œä¸éœ€è¦ä½ é‡æ–°è®¡ç®—ï¼‰ï¼š
${humanSummary
  .map(
    (h, i) => `
${i + 1}. ${h.title}
- ç»“è®ºï¼š${h.oneLine}
- è¦ç‚¹ï¼š${h.bullets.join(" / ")}
${h.advice?.length ? `- å»ºè®®ï¼š${h.advice.join(" / ")}` : ""}
`.trim()
  )
  .join("\n\n")}

ä½ çš„ä»»åŠ¡ï¼šåŸºäºä»¥ä¸Šç»“è®ºï¼Œä»ã€Œ${modeTitle}ã€è§’åº¦ç»™å‡ºä¸€ä¸ªâ€œèƒ½è½åœ°çš„æ·±åº¦æŠ¥å‘Šâ€ã€‚

è¾“å‡ºæ ¼å¼ï¼ˆå¿…é¡»éµå®ˆï¼‰ï¼š
1) ä¸€å¥è¯æ€»ç»“ï¼ˆ<= 35 å­—ï¼Œåƒç»“è®ºï¼Œä¸è¦é“ºå«ï¼‰
2) 5 æ¡æ ¸å¿ƒæ´å¯Ÿï¼ˆç¼–å· 1-5ï¼Œæ¯æ¡ 2-4 å¥ï¼Œå¿…é¡»å…·ä½“ï¼‰
3) 3 æ¡å¯æ‰§è¡Œå»ºè®®ï¼ˆæ¯æ¡ä»¥â€œğŸ‘‰â€å¼€å¤´ï¼‰
4) 1 ä¸ªæé†’ï¼ˆä»¥â€œâš ï¸â€å¼€å¤´ï¼ŒæŒ‡å‡ºæœ€å®¹æ˜“ç¿»è½¦çš„ç‚¹ï¼‰

é£æ ¼è¦æ±‚ï¼š
- ä¸è¦å †æœ¯è¯­ï¼Œä¸è¦å†™â€œæ ¹æ®ä½ çš„æ˜Ÿç›˜æ˜¾ç¤ºâ€
- ä¸è¦èƒ¡ç¼–ä¸å­˜åœ¨çš„ç›¸ä½/å®«ä½
- å…¨æ–‡ä¸­æ–‡è¾“å‡ºï¼Œå¯é€‚åº¦ä½¿ç”¨ emojiï¼ˆä½†ä¸è¦è¿‡é‡ï¼‰
`;
}
